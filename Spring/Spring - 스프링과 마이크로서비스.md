# Spring - 이론 정리



## 1 . Spring & Cloud 기본 개념

### 1) 기본 개념

```
1. REST : HTTP 동사를 수용해 서비스의 핵심 동작을 표현하고 서비스의 데이터를 요청하고 수신하기 위해 웹 기반 데이터 직렬화 프로토콜을 사용하는 것이다.

2. 기존 애플리케이션 구축 방식을 바꾸는 이유
	1) 복잡성 증가 : 단 하나의 DB와 통신하고 다른 애플리케이션과 연결되지 않은 단절된 애플리케이션은 더이상 표준이 될 수 없다. 오늘날의 애플리케이션은 회사 데이터센터 내부의 여러 서비스, DB뿐만 아니라 외부의 서비스 제공자와도 통신해야 한다
	2) 재빠른 출시 요구 : 고객은 더 이상 소프트웨어 패키지를 연 단위로 릴리스하길 요구하지 않는다. 고객들은 더이상 기다리지 않고 몇 주 혹은 며칠 안에 재빠르게 제품이 출시되길 원한다
	3) 성능 및 확장성 : 글로벌 애플리케이션은 처리해야할 트랜잭션의 유입 시점과 양을 예측하기 힘들다. 따라서 기존 애플리케이션과 달리 지금은 애플리케이션은 트랜잭션 유입 시점에 서버를 확장 시키거나 축소해야 한다
	4) 회복성 및 지속성 요구 : 고객은 손쉽게 경쟁사로 이탈할 수 있으므로 회사의 애플리케이션에 오류가 있떠라도 애플리케이션 전체가 다운되면 안된다. 따라서 애플리케이션의 회복성이 높아야한다.
	
3. microservice에 요구되는 특징
	1) SSD
		(1) Small, 작다 :
		(2) Simple, 단순하다
		(3) Decoupled, 분리되어있다
	2) SRF
		(1) Scalable, 확장 가능하다 : 분리된 서비스를 여러 서버에 수평적으로 쉽게 분산할 ㅅ ㅜ있어 기능 및 서비스를 적절하게 확장할 수 있다.
		(2) Resilient, 회복력이 있다 : 오류가 발생하더라도 애플리케이션의 작은 부분에 국한되어 애플리케이션의 전체 장애로 확대되기 전에 억제된다.
		(3) Flexible, 유연하다 : 새로운 기능을 신속하게 제공하도록 분리된 서비스를 구성하고 재배치 할 수 있다

4. microservice business 구성 시 고려해야할 요소
	1) 적정 크기 : 한 가지 책임 영역에 집중하게 하는 방법은 무엇인가
	2) 확장성 : 서비스 간 의존성을 최소화하면서 애플리케이션이 신속히 확장할 수 있는 방법 무엇인가
	3) 반복성 : 새로운 서비스 인스턴스가 시작될 때마다 기존 인스턴스와 동일한 코드와 구성으로 유지할 수 있는 방법은 무엇인가
	4) 회복성 : 서비스에 문제가 있을 때 서비스 클라이언트가 '빨리 실패'하게 하는 방법은 무엇인가
	5) 위치 투명성 : 서비스 클라이언트에 영향을 주지 않고 서비스 인스턴스를 추가 및 삭제할 수 있도록 물리적 위치를 어떻게 관리하는가?
	
5. microservice pattern
	1) 핵심 개발 패턴, core development patterns : 
```

### 2) Microservice 핵심 개발 패턴

* 마이크로서비스 구축에 대한 기본 사항들

```
1. 서비스 세분성
	1) 비즈니스 영역을 마이크로서비스로 분해해서 각 마이크로서비스가 적정 수준의 책임을 담당하게 하는 방법
	2) coarse-grained : 서비스가 다른 비즈니스 문제 영역과 책임이 겹치도록 너무 굵게 나뉘는 경우이다. 너무 굵게 나뉘게 되면 시간이 지나면서 유지 보수와 변경이 어려워 진다
	3) fine-grained :서비스가 너무 잘게 나뉘는 경우이다. 해당 경우에선 애플리케이션이 전반적으로 복잡해지고 서비스가 데이터 저장소에 액세스하는 것 외엔 아무런 로직도 갖지 않는 멍청한 수준의 데이터 추상화 계층으로 전락하게 된다
	
2. 통신 프로토콜 : 클라이언트와 서비스가 데이터를 교환하는 방법은 무엇인가

3. 인터페이스 설계
	1) 서비스 엔드포인트를 클라이언트에 공개하는 방법은 무엇인가
	2) 서비스 의도를 전달하도록 서비스 URL을 구조화하는 방법
	3) 서비스 버전 관리 방법
	4) 서비스를 직관적으로 사용할 수 있도록 마이크로서비스 인터페이스를 설계하는 방법
	
4. 구성 관리 : 서비스가 애플리케이션별 구성을 관리해 코드와 구성이 독립적인 개체가 되는 방법은 무엇인가

5. 이벤트 프로세싱
	1) 이벤트를 사용해 서비스 간 상태 및 데이터 변경 사항을 통신하는 방법은 무엇인가
	2) 서비스 간 하드 코딩된 의존성을 최소화하고 애플리케이션의 회복성을 높이기 위해 마이크로서비스를 분리하는 방법
```

* 마이크로서비스 라우팅 패턴

```
1. 마이크로서비스 라우팅 패턴 : 서비스의 물리적 IP 주소를 추상화하고 서비스 호출에 대한 단일 진입점을 만들어 모든 서비스 호출에 대한 일관된 보안과 콘텐츠 정책을 보장한 상태에서마이크로서비스를 사용하려는 클라이언트 애플리케이션 서비스의 위치를 발견하고 라우팅하는 방법에 대한 패턴

2. 서비스 디스커버리
	1) 클라이언트 애플리케이션이 서비스 위치를 하드 코딩하지 않고 찾을 수 있도록 마이크로서비스를 탐색하는 방법
	2) 오작동하는 마이크로서비스 인스턴스를 가용 서비스 인스턴스 풀에서 제거하는 방법
	
3. 서비스 라우팅 : 보안 정책과 라우팅 규칙을 마이크로서비스 애플리케이션의 여러 서비스와 서비스 인스턴스에 차별 없이 적용하기 위해 모든 서비스에 대한 단일 진입점을 제공하는 방법

4. 특징
	1) 서비스 디스커버리와 서비스 라우팅 사이에는 순서가 있어 보이지만 두 패턴은 종속적이지 않다
```

* 마이크로서비스 클라이언트 회복성 패턴

```
1. 등장배경 : 마이크로서비스 아키텍처는 고도로 분산되어 있어서 1개의 서비스에 문제가 생기더라도 문제가 소비자에게 발생하지 않도록해야 한다

2. 클라이언트 회복성 패턴
	1) 클라이언트 측 부하 분산 : 마이크로서비스의 여러 인스턴스에 대한 호출이 정상 인스턴스에 분산하도록 서비스 인스턴스의 위치를 캐싱하는 방법
	2) 회로 차단기 패턴 : 성능 문제가 있는 서비스를 계속 호출하지 않게 하는방법. 비정상 마이크로 서비스의 호출을 빨리 실패하도록 하는 방법
    3) 폴백 패턴 : 서비스 호출이 실패할 대 호출한 마이크로서비스가 아닌 다른 대체 수단을 사용해 서비스 클라이언트가 작업을 수행하게 할 수 있게 하는 방법
    4) 벌크헤드 패턴 : 오작동하는 서비스 호출 하나가 나머지 애플리케이션에 부정적인 영향을 미치지 않도록 호출을 구분하는 방법
```

* 마이크로서비스 보안 패턴

```
1. 인증, authentication : 서비스를 호출하는 서비스 클라이언트를 확인하는 것

2. 인가, authorization : 마이크로서비스를 호출하는 서비스 클라이언트가 수행하려는 작업을 수행할 자격이 있는지 확인하는 것

3. 자격 증명 관리 와 전파, credential management & propagation : 서비스 클라이언트가 한 트랜잭션과 과녈ㄴ되 여러 서비스 호출에서 자격 증명을 항상 제시하지 않아도 될 방법
```

* 마이크로서비스 로깅 및 추적 패턴

```
1. 등장 배경: 마이크로서비스가 모놀리식 애플리케이션에 비해 가지는 단점은 애플리케이션과 서비스 안에서 어떤 일이 발생하는 지에 대한 디버깅과 추적이 훨씬 어렵다는 점에 있다

2.로깅 및 추적 패턴
	1) 로그 상관관계, log correlation : 단일 트랜잭션에 대해 여러 서비스 간 생성된 모든 로그를 함께 연결하는 것 
	2) 로그 수집, log aggregation : 서비스에서 생성된 모든 로그를 질의 가능한 단일 인터페이스로 취합하는 것
	3) 마이크로서비스 추적, microservice tracing : 트랜잭션과 연관된 모든 서비스에서 클라이언트 트랜잭션 흐름을 시각화 하고 트랜잭션과 관련된 서비스 성능과 관련된 특성을 이해하는 것
```

* 마이크로서비스 빌드 및 배포 패턴

```
1. 빌드 및 배포 파이프라인 : 조직의 모든 환경에서 원클릭 빌드와 배포를 강조하는 반복 가능한 빌드 및 배포 프로세스

2. 코드형 인프라스트럭처 : 소스 제어를 사용해 실행하고 관리할 수 있는 코드로 서비스 프로비저닝을 처리하는 것

3. 불변 서버 : 마이크로서비스 이미지를 생성하고 배포한 후 변경하지 못하게 하는 것

4. 피닉스 서버 : 서버가 오래 실행될수록 구성 편차가 발생할 가능성도 높아지는데 이때 마이크로서비스를 실행하는 서버를 정기적으로 종료하고 불변 이미지를 재생성하는 것
```

### 3) 스프링 클라우드 기술들

```
1. 스프링 부트 : HTTP 형식의 동사를 URL에 매핑하고 JSON 프로토콜을 자바 객체로 직렬화할 뿐만 아니라 자바 예외를 표준 HTTP 에러 코드에 매핑하는 작업을 해준다

2. 스프링 클라우드 컨피그 : 중앙 집중식 서비스로 애플리케이션 구성 데이터 관리를 담당하고 애플리케이션 데이터를 마이크로 서비스와 완전히 분리해 마이크로서비스 인스턴스가 아무리 많더라도 항상 동일한 구성을 유지하도록 한다

3. 스프링 클라우드 서비스 디스커버리 : 서비스를 사용하는 클라이언트에 서버가 배포된 물리적 위치를 추상화 할 수 있다

4. 스프링 클라우드/넷플릭스 hystrix와 ribbon : 마이크로서비스 클라이언트 회복성 패턴을 위 해 사용하는 라이브러리와 프로젝트 

5. 스프링클라우드/넷플릭스 Juul : 마이크로서비스 애플리케이션을 위한 서비스 라우팅 기능

6. 스프링 클라우드 스트림 : 마이크로서비스에 경량 메시지 프로세싱을 쉽게 통합할 수 있는 기술

7. 스프링 클라우드 sleuth : 애플리케이션 안에서 사용되는 HTTP 호출과 메시지 채널에서 고유 추적 식별자를 통합할 수 있는 기술

8. 스프링 클라우드 security : 서비스에 액세스 할 수 있는 사람과 어떤 일을 할 수 있는지 통제할 수 있느 ㄴ인증 및 인가 프레임워크

9. provisioning : 스프링 클라우드의 빌드와 배포 파이프라인
```

## 2.

### 1) 마이크로서비스 아키텍처 설계 

```
1. 비즈니스 문제의 분해 
    1) 비즈니스 문제를 기술하고 그 문제를 기술하는 데 사용된 명사에 주목하라
    2) 동사에 주목하라
    3) 데이터 응집성을 찾아라 

2. 서비스 세분화

3. 서비스 인터페이스 
    1) REST : 서비스 호출 프로토콜로 HTTP를 수용하고 표준 HTTP 동사를 사용하는 것
    2) URI를 통해 의도 전달
    3) 요청과 응답에 JSON을 사용
    4) HTP 상태 코드로 결과를 전달
		
```

### 2) 마이크로서비스를 사용하지 않아야 하는 경우

```
1. 분산 시스템 구축의 복잡성 : 고도로 분산된 애플리케이션을 성공시키는 데 필요한 자동화와 운영 작업에 투자할 의사가 없는 조직이라면 마이크로서비스를 고렿지 않는 것이 좋다

2. 가상 서버/컨테이너의 스프롤 : 필요한 서버나 컨테이너가 많을 수록 마이크로서비스를 실행하는 비용이 저렴해지지만 서비를 관리하고 모니터링하는 운영 작업이 복잡해지므로 지나치게 운영이 복잡해지는 경우 마이크로서비스가 알맞지 않을 수 있다

3. 애플리케이션 유형 : 애플리케이션의 유형이 소형이나 소수 사용자를 위해 개발될 경우 마이크로서비스와 같은 분산 모델로 구축하면 얻게 될 가치보다 비용이 더 클 수 있다

4. 데이터 변환과 일관성 : 애플리케이션이 여러 데이터 소스에서 복잡한 데이터를 취합하고 변환해야 할 경우 마이크로서비스의 분산된 특성 때문에 작업이 어려워지고 성능 문제에도 취약해 질 것이다
```

### 3) REST 접근법

```
1. 서비스 호출 프로토콜로 HTTP를 사용한다 : 서비스는 HTTP 엔드포인트로 호출되고 HTTP 프로토콜을 사용해 서비스와 데이터를 교환한다

2. HTTP 표준 동사를 사용해 매핑한다 : CRUD(PUT, GET, POST, DELETE)함수를 사용해 서비스 행동 양식을 매핑한다

3. 서비스끼리 교환하는 모든 데이터의 직렬화 형식으로 JSON을 사용한다

4. HTTP 상태 코드를 사용해 서비스 호출 상태를 전달한다
```

