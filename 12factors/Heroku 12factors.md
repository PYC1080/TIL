# Heroku 12factors

## 0. Introductions

### 1) 특징

```
1. 설정 자동화를 위한 절차를 쳬계화하여 새로운 개발자가 프로젝트에 참여하는데 드는 시간과 비용을 최소화한다

2. OS에 따라 달라지는 부분을 명확히 하고, 실행 환경 사이의 이식성을 극대화 한다

3. 최근 등장한 클라우드 플랫폼 배포에 적합하고 서버와 시스템의 관리가 필요없게 된다

4. 개발 환경과 운영 환경의 차이를 최소화하고 민첩성을 극대화하기 위해 지속적인 배포가 가능하다

5. 툴, 아키텍처, 개발 방식을 크게 바꾸지 않고 확장할 수 있다
```



### 2) 대상

```
서비스로 동작하는 애플리케이션을 개발하는 모든 개발자나 애플리케이션을 관리하고 배포하는 인프라 엔지니어
```





## 1. 12Factors

### 1) BASE CODE

```
1. 의미 : 버전 관리되는 하나의 베이스코드로 배포를 한다

2. 베이스코드와 앱 사이에는 항상 1:1 관계가 성립한다
	1) 베이스코드가 여러개 있는 경우 앱이 아니라 분산 시스템에 가깝다. 따라서 분산 시스템의 개별 구성요소가 앱이 되며, 개별 앱이 12factors를 따른다
	2) 여러 개의 앱이 동일한 코드를 공유하면 12factors를 위반하게 된다. 따라서 이를 해결하기 위해 공유하는 코드를 라이브러리화 시키고 해당 라이브러리를 종속성으로 관리해야 한다

3. 앱의 베이스코드는 한개여야 하지만 앱의 배포는 여러개가 될 수 있다. 
```



### 2) DEPENDENCY ISOLATION

```
1. 의미 : 명시적으로 선언되고 분리되어 있는 종속성

2. 12factors 앱은 전체 시스템 중 특정 패키지가 암묵적으로 존재하는 것에 절대로 의존하지 않는다. manifest를 이용해 모든 종속성을 완전, 엄격하게 관리해야 한다.

3. 12factors 앱은 어떠한 시스템 도구에도 암시적으로 의존하지 않는다.
```

### 3) CONFIGURATIONS

```
1. 의미 : 환경에 저장된 설정

2. App configurations에 포함되는 것
	1) Back-end service resource handle : Db, memcached 등
	2) 외부 서비스 인증 정보
	3) 배포마다 달라지는 값

3. 특징
	1) 설정을 코드에서 엄격하게 분리할 것을 요구한다
	2) 설정을 환경변수인 envvars나 env에 저장한다
	3) 각각의 환경변수는 env로 묶여있지만 대신 각 배포마다 독립적으로 관리된다h
```

### 4)  LINKABLE BACKING SERVICES

```
1. 의미 : 백엔드 서비스를 연결된 리소스로 취급한다

2. 특징
	1) 로컬 서비스와 서드파티 서비스를 구별하지 않는다.
	2) 각각의 다른 백엔드 서비스를 리소스로 다루므로 느슨하게 결합된다
	3) 리소스는 자유롭게 배포에 연결되거나 분리될 수 있다.
```



### 5) BUILD, RELEASE, RUN

```
1. 의미 : 철저하게 분리된 빌드와 실행 단계

2. BASECODE 기반 3단계 배포 변환 과정
	1) BUILD : 코드 저장소를 빌드라는 실행 가능한 번들로 변환시키는 단계이다. 빌드 단계에서는 커밋된 코드 중 배포 프로세스에서 지정된 버전을 사용하며, 종속성을 가져와 바이너리와 에셋들을 컴파일한다
	2) RELEASE : 빌드 단계에서 만들어진 빌드와 배포의 현재 설정을 결합한다. 완성된 릴리즈는 빌드와 설정을 모두 포함하며 실행 환경에서 바로 실행될 수 있도록 준비된다.
	3) RUN : 선택된 릴리즈에 대한 애플리케이션 프로세스의 집합을 시작하여, 애플리케이션을 실행 환경에서 돌아가도록 한다

3. 특징
	1) 배포 도구는 일반적으로 릴리즈 관리 도구를 제공한다 
	2) 모든 릴리즈는 항상 유니크한 릴리즈 아이디를 지녀야 한다
	3) 빌드는 새로운 코드가 배포될 때마다 개발자에 의해 시작된다. 반면, 실행 단계는 서버가 재부팅 되거나 충돌이 발생한 프로세스가 프로세스 매니저에 의해 재시작 되었을 때 자동으로 실행될 수 있다. 따라서 실행 단계는 최대한 변화가 적어야 한다
	
```

### 6) STATELESS PROCESSES

```
1. 의미 : 애플리케이션을 하나 혹은 여러개의 stateless한 프로세스로 실행한다

2. 특징
	1) stateless : 프로세스는 무상태이며 아무 것도 공유하지 않는다. 유지할 필요가 있는 모든 데이터는 DB같은 안정된 백엔드 서비스에 저장되어야 한다.
	2) 
```

### 7)  PORT BINDING

```
1. 의미 : 포트 바인딩을 사용해 서비스를 공개한다

2. 특징
	1) 완전히 독립적이며 웹서버가 웹 서비스를 만들기 위해 처리하는 실행환경에 대한 런타임 인젝션에 의존하지 않는다
	2) 포트를 바인딩하여 HTTP 서비스로 공개되며 해당 포트로 들어오는 요청을 기다린다
	3) 하나의 앱이 다른 앱을 위한 백엔드 서비스가 될 수 있다 : 백엔드 앱의 URL을 사용할 앱의 설정의 리소스 핸들로 추가하는 방식으로 앱이 다른 앱을 백엔드 서비스로 사용할 수 있다
```

### 8) CONCURRENCY

```
1. 의미 : 프로세스 모델을 통한 확장

2. 특징
	1) 애플리케이션의 작업을 적절한 프로세스 타입에 할당함으로써 다양한 작업 부하를 처리할 수 있도록 설계할 수 있다.
	2) 프로세스를 절대 데몬화해서는 안되며 PID 파일을 작성해서는 안된다. 대신 OS의 프로세스 관리자나 클라우드 플랫폼의 분산 프로세스 매니저를 사용하게 된다
```

### 9) DISPOSABILITY

```
1. 의미 : 빠른 시작과 graceful shutdown을 통한 안정성 극대화

2. 특징
	1) 간단한게 프로세스를 폐기할 수 있다 : 신축성 있는 확장과 코드, 설정의 변화를 빠르게 배포할 수 있게 한다.
	2) graceful shutdown : 서비스 포트의 수신을 중지하고 현재 처리 중인 요청이 끝나길 기다린 뒤에 프로세스가 종료되게 된다.
```

### 10) DEVELOPMENT & PRODUCTION PARITY

```
1. 의미 : Development, Staging, Production 환경을 최대한 비슷하게 유지한다

2. 개발 환경과 배포 환경이 차이나는 이유
	1) 시간적 차이 : 개발자가 작업한 코드가 실제 배포되기까지 시간적 차이가 발생할 수 있다
	2) 담당자의 차이 : 개발자가 작성한 코드를 시스템 엔지니어가 배포한다
	3) 툴의 차이 : 개발자와 배포자가 사용하는 툴의 종류가 다를 수 있다
	
3. 12factors의 배포 디자인
	1) 시간 간격 최소화 
	2) 담당자의 차이 간격 최소화
	3) 툴의 차이 최소화
```

### 11) LOGS

```
1. 의믜 : 로그를 이벤트 스트림으로 취급한다

2. 특징 
	1) 아웃풋 스트림의 전달이나 저장에 절대 관여하지 않는다
	2) staging이나 production에서 각 프로세스의 스트림은 실행 환경에서 수집된 후 앱의 다른 모든 스트림과 병합되어 열람하거나 보관하기 위한 하나 이상의 최종 목적지로 전달된다
	3) 앱의 이벤트 스트림은 파일로 보내지거나 터미널에서 실시간으로 보여질 수 있다.
```

### 12) ADMIN PROCESSES FOR EVENTUAL PROCESSES

```
1. 의미 : Admin/maintainance 작업을 이회성 프로세스로 실행한다.

2. 특징
	1) 일회성 admin 프로세스는 애플리케이션의 일반적으로 오래 실행되는 프로세스들과 동일한 환경에서 실행되어야 한다
	2) 모든 프로세스 타입들에는 동일한 종속성 분리 기술이 사용되어야 한다
```



